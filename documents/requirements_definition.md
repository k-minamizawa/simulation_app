# デジタルツインデモシステム要件定義書

## 1. プロジェクト概要

### 1.1 背景と目的
- 展示会にてデジタルツインのデモを実施
- 工場シミュレーション（FlexSim）とWebアプリケーション、カメラ・ARマーカーを組み合わせた統合システム
- 鉄道車両のような大型ワークの製造工程を可視化・最適化

### 1.2 スコープ
- 2025年9月中にミニマムモデルでのデジタルツインモックを完成
- 3つのタクトが直列接続された製造ラインのシミュレーション
- リアルタイムでの進捗管理と作業指示

## 2. システム要件

### 2.1 機能要件

#### 2.1.1 体験者機能
- ARマーカーを使用したワークの進捗確認・再現
- カメラでARマーカーの位置を基に工程進捗データを作成
- シミュレーション開始ボタンのクリック
- シミュレーション結果の確認

#### 2.1.2 シミュレーション機能
- シミュレーション開始処理完了リクエスト受信
- FlexSimシミュレーション実行（最終的には実験ツールで実行）
- シミュレーション完了通知
- 結果データのDB格納

#### 2.1.3 データ管理機能
- 工程進捗データのDB格納
- シミュレーション結果の保存と取得
- グローバルテーブルとの連携

#### 2.1.4 表示機能
- PC画面でのシミュレーション開始画面
- Next.jsによるWeb UI
- シミュレーション結果表示（残業時間、人員配置変更提案など）

### 2.2 非機能要件

#### 2.2.1 性能要件
- シミュレーション実行時間：3分以内
- API応答時間：1秒以内
- 同時接続数：展示会での利用を想定（10ユーザー程度）

#### 2.2.2 可用性要件
- 展示会期間中の安定稼働
- エラー発生時の復旧手順明確化

#### 2.2.3 セキュリティ要件
- ローカルネットワーク内での運用
- データの暗号化は必須としない（デモ環境）

## 3. システム構成

### 3.1 アーキテクチャ
```
[フロントエンド(Next.js)]
    ↓↑ REST API
[バックエンド(FastAPI)]
    ↓↑ Socket/HTTP
[FlexSim]
    ↓↑
[データベース(SQL)]
```

### 3.2 技術スタック
- **フロントエンド**: Next.js (React)
- **バックエンド**: FastAPI (Python)
- **シミュレーション**: FlexSim
- **データベース**: PostgreSQL/SQLite
- **通信**: REST API, WebSocket

## 4. データフロー（⑪〜⑭の詳細）

### 4.1 ⑪シミュレーション完了リクエスト
**送信元**: FlexSim  
**送信先**: FastAPI  
**データ形式**: JSON
```json
{
  "simulation_id": "sim_001",
  "status": "completed",
  "completion_time": "2025-09-18T10:30:00Z",
  "result_summary": {
    "total_time": 180.5,
    "completed_tasks": 45,
    "worker_utilization": 0.85
  }
}
```

### 4.2 ⑫結果をDBに格納
**処理**: FastAPIがシミュレーション結果をデータベースに保存
**格納先テーブル**: simulation_results, work_progress_history

### 4.3 ⑬シミュレーション完了レスポンス
**送信元**: FastAPI  
**送信先**: Next.js  
**データ形式**: JSON
```json
{
  "status": "success",
  "simulation_id": "sim_001",
  "message": "Simulation completed successfully",
  "result_url": "/api/results/sim_001"
}
```

### 4.4 ⑭シミュレーション結果表示
**処理**: Next.jsが結果データを取得してUIに表示
**表示内容**:
- 生産性指標（サイクルタイム、スループット）
- ボトルネック分析
- 改善提案（残業時間削減、人員配置最適化）
- グラフィカルな可視化

## 5. ユースケース

### 5.1 基本フロー
1. 体験者がワークの進捗を手で置き換えて再現
2. カメラでARマーカーの位置を撮影
3. システムが工程進捗データを作成
4. 体験者がシミュレーションボタンをクリック
5. シミュレーション開始処理完了アラート表示
6. FlexSimでシミュレーション実行
7. シミュレーション完了
8. 結果をDBに格納
9. 結果画面表示
10. 体験者が結果を確認

### 5.2 例外フロー
- ARマーカー認識失敗時の再撮影
- シミュレーション失敗時のリトライ
- DB接続エラー時の処理

## 6. 制約事項

### 6.1 前提条件
- FlexSimライセンスが利用可能
- 展示会場でのネットワーク環境
- ARマーカーの印刷・配置

### 6.2 制限事項
- 初期版では3タクトの直列接続のみ
- 評価値は0/1の2値判定
- 並列タスクは未対応

## 7. 用語定義

| 用語 | 説明 |
|------|------|
| タクト | 製造工程の一単位（ステーション） |
| ワーク | 製造対象物（鉄道車両など） |
| ARマーカー | カメラで認識可能なマーカー |
| グローバルテーブル | FlexSim内のデータ管理テーブル |
| evaluation_value | タスク実施可否の評価値 |

## 8. リリース計画

### Phase 1（2025年9月）
- ミニマムモデルの実装
- 基本的な連携機能
- 単純な評価ロジック

### Phase 2（将来）
- 並列タスク対応
- 高度な評価アルゴリズム
- リアルタイム最適化

## 9. 承認事項

本要件定義書に基づき、システム開発を進めることを承認します。

承認者: _______________  
日付: _________________